<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Catálogo | El Rincón de la Tati</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: white;
    }

    h2 {
        margin: 20px;
        margin-bottom: 10px;
    }

    .categoria {
        overflow-x: auto;
        white-space: nowrap;
        padding: 20px;
    }

    .producto {
        display: inline-block;
        width: 180px;
        background: #f6f6f6;
        border-radius: 10px;
        margin-right: 20px;
        padding: 10px;
        vertical-align: top;
        white-space: normal;
        box-shadow: 0 0 4px rgba(0,0,0,0.1);
    }

    .producto img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 8px;
    }

    .agotado {
        color: red;
        font-weight: bold;
        margin-top: 5px;
        display: block;
    }

    .precio {
        font-size: 18px;
        font-weight: bold;
    }
</style>
</head>

<body>

<h1 style="text-align:center; padding:20px;">Catálogo de Productos</h1>

<div id="contenedor-categorias"></div>

<!-- SUPABASE SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.1/dist/umd/supabase.min.js"></script>

<script type="module">

/* CONFIGURACIÓN SUPABASE */
const SUPABASE_URL = "https://wazkoegfeuttutfoqfjt.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_PwMGk7yJAN-1q_a_meHcKQ_CuWSSrgF";

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* FUNCIÓN PRINCIPAL: CARGAR PRODUCTOS */
async function cargarCatalogo() {

    const { data: productos, error } = await supabaseClient
        .from("productos")
        .select("*")
        .order("categoria", { ascending: true });

    if (error) {
        document.getElementById("contenedor-categorias").innerHTML =
            "<p>Error cargando productos.</p>";
        return;
    }

    // Agrupar productos por categoría
    let categorias = {};

    productos.forEach(p => {
        if (!categorias[p.categoria]) categorias[p.categoria] = [];
        categorias[p.categoria].push(p);
    });

    let html = "";

    // Construir HTML por categoría
    for (let categoria in categorias) {

        html += `<h2>${categoria}</h2>`;
        html += `<div class="categoria">`;

        categorias[categoria].forEach(p => {

            html += `
                <div class="producto">
                    <img src="${p.imagen_url}">
                    <div class="precio">$${p.precio}</div>
                    <div>${p.nombre}</div>
                    <div>${p.descripcion}</div>
                    ${p.agotado ? `<span class="agotado">AGOTADO</span>` : ""}
                </div>
            `;
        });

        html += `</div>`;
    }

    document.getElementById("contenedor-categorias").innerHTML = html;
}

cargarCatalogo();

</script>

</body>
</html>
